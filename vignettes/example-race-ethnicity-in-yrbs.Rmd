---
title: "Race/ethnicity in YRBS"
author: "Martin Barner (copied directly and then edited from Thomas Lumley's rimu package Vignette (https://github.com/tslumley/rimu)"
date: "03/09/2019"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{YRBS-ethnicity}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The `usethnicity` data set contains variables on race and ethnic identification from the 2017 Youth Risk Behaviour Survey, together with two variables on smoking behaviour.  The YRBS is a multistage cluster-sampled survey, so valid inference about associations requires using survey design information. This subset of variables without weights is useful only for demonstration purposes. 

```{r}
library(categorical)
data(usethnicity)
head(usethnicity)
```

Question 4 asks *Are you Hispanic or Latino?*, and Question 5 asks for any of  

- A. American Indian or Alaska Native, 
- B. Asian, 
- C. Black or African American, 
- D. Native Hawaiian or Other Pacific Islander, 
- E. White

that apply.  In the data set, these five letters are pasted together into a single variable.



We need to split `Q5` into its component letters. One way is to use `strsplit`, producing a list with a vector of zero to five letters for each individual, then call the `as.mr` method for lists.

```{r}
race<-as_categorical(strsplit(as.character(usethnicity$Q5),""))
cl_table(race)
```

There's a spurious `" "` category from the string splitting, and the values `F`, `G`, and `H` are also invalid, so we need to remove them

```{r}
race<-cat_remove_levels(race,c(" ","F","G","H"))
cl_table(race)
```

We might want easier-to-recognise names for the categories.
We add an alternative value for each level that we will call "label"

```{r}

race <- categorical(race,
            levels = c("A", "B","C","D","E"),
            alternatives= list(
              label = c("AmIndian",
                        "Asian",
                        "Black", 
                        "Pacific","White")
              )
            )

```

We can show the 'label' alternative:

```{r}

alternate(race, 'label') %>% categorical %>% head

```


Default plotting changes depending on available packages (UpSetR):

```{r}
plot(race)
```


<!-- Now, Hispanic/Latino ethnicity is asked in a separate question. We convert it via the `as.mr` method for logical vectors, and then combine it with `race` -->

<!-- ```{r} -->
<!-- hispanic<-as.mr(usethnicity$Q4==1, "Hispanic") -->
<!-- ethnicity<-mr_union(race, hispanic) -->
<!-- ethnicity[101:120] -->
<!-- ``` -->

<!-- The `plot` method shows co-occurence of the various race/ethnicity terms -->

<!-- ```{r} -->
<!-- plot(ethnicity,nsets=6) -->
<!-- ``` -->

<!-- Tabulations against other factor or multiple-response variables are possible with `mtable`.  Note that `mtable` shows frequencies for each category; use `as.character` to get frequencies for combinations -- do not use `as.factor`, which is not generic and so cannot have a `mr` method. -->

<!-- ```{r} -->
<!-- mtable(ethnicity, usethnicity$QN30) -->
<!-- table(ethnicity %has% "Black", usethnicity$QN30) -->
<!-- table(ethnicity %hasonly% "Black", usethnicity$QN30) -->
<!-- table(as.character(ethnicity), usethnicity$QN30) -->
<!-- table(forcats::fct_lump(as.character(ethnicity), n=10),    usethnicity$QN30) -->
<!-- ``` -->
